<!DOCTYPE html><html lang="en" mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Active Directory简介" /><meta name="author" content="RingLcy" /><meta property="og:locale" content="en_US" /><meta name="description" content="LDAP与AD" /><meta property="og:description" content="LDAP与AD" /><link rel="canonical" href="https://ringlcy.github.io/posts/ActiveDirectory%E7%AE%80%E4%BB%8B/" /><meta property="og:url" content="https://ringlcy.github.io/posts/ActiveDirectory%E7%AE%80%E4%BB%8B/" /><meta property="og:site_name" content="我的学习笔记" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-12-31T23:59:59+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Active Directory简介" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"RingLcy"},"description":"LDAP与AD","url":"https://ringlcy.github.io/posts/ActiveDirectory%E7%AE%80%E4%BB%8B/","@type":"BlogPosting","headline":"Active Directory简介","dateModified":"2020-12-31T23:59:59+08:00","datePublished":"2020-12-31T23:59:59+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://ringlcy.github.io/posts/ActiveDirectory%E7%AE%80%E4%BB%8B/"},"@context":"https://schema.org"}</script><title>Active Directory简介 | 我的学习笔记</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/favicons/ms-icon-144x144.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">我的学习笔记</a></div><div class="site-subtitle font-italic">种一棵树最好的时间是五年前，其次是现在</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tabs/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tabs/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/tabs/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/tabs/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/RingLcy" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['',''].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Active Directory简介</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Active Directory简介</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Thu, Dec 31, 2020, 11:59 PM +0800" > Dec 31, 2020 <i class="unloaded">2020-12-31T23:59:59+08:00</i> </span> by <span class="author"> RingLcy </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1156 words">6 min</span></div></div><div class="post-content"><h2 id="ldap与ad">LDAP与AD</h2><p>LDAP: Lightweight Directory Access Protocol, 轻量级目录访问协议。协议只是一套抽象的标准，Windows AD就是基于LDAP协议实现的一套应用，用于提供域环境中用户及用户组的管理与认证。</p><p>AD由目录服务数据库+一套访问协议组成: 它是一个树形数据库，适合用来存储不需要经常更改、需要快速查找的数据。同时，AD还是一个LDAP服务端，供client连接、查询、以及其他操作。</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/clipboard-1605420337167.png" alt="img" /></p><p>LDAP结构和常用术语如下：</p><p>一条路径上的dc, ou, cn组合起来成为dn，能唯一标识一条记录位置。</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/clipboard-1605420525589.png" alt="img" /></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/clipboard-1605420543593.png" alt="img" /></p><h2 id="naming-context"><a href="https://en.wikipedia.org/wiki/Naming_Context">Naming Context</a></h2><p>AD使用NC将不同类型的数据归为不同的分区，Domain Controllers之间同步数据也是按照NC单独同步。</p><p>Active Directory can support tens of millions of objects. To scale up those objects, the Active Directory database is divided up into partitions for replication and administration. Each logical partition replicates its changes separately among domain controllers in the forest.</p><p>By default, the Active Directory Domain Service contains the following naming contexts:</p><ul><li>Schema NC: stores schema information that is replicated to domain controllers in all domains of the forest.<li>Configuration NC: stores configuration data information that is replicated to domain controllers in all domains of the forest.<li>Domain NC: store domain information such as users and computers that is replicated to domain controllers in that domain only.</ul><p>使用AD自带的ADSI Edit或SysinternalsSuite中的ADExplorer.exe均可查看3个NC中的内容。</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/image-20201115142256161.png" alt="image-20201115142256161" /></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/image-20201115142342588.png" alt="image-20201115142342588" /></p><h3 id="schema-nc">Schema NC</h3><p>Schema NC存储了类、属性的Schema信息，以Domain NC中 <code class="language-plaintext highlighter-rouge">CN=WIN10-PC,CN=Computers,DC=ring2,DC=com</code>为例，它是Computer类的一个实例。在Schema NC里可以看到它有哪些属性。</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/image-20201115143526903.png" alt="image-20201115143526903" /></p><p>NC中每一个条目都是一个实例，这里的<code class="language-plaintext highlighter-rouge">CN=Computer,CN=Schema,CN=Configuration,DC=ring2,DC=com,ringdc-pc [ringdc-pc.ring2.com]</code>既描述了computer类的信息，它本身也是一个classSchema类的实例。</p><ul><li>defaultObjectCategory: 指定类实例的ObjectCategory的值，defaultObjectCategory值并不唯一，例如person类、user类的defaultObjectCategory都是<code class="language-plaintext highlighter-rouge">CN=Person,CN=Schema,CN=Configuration,DC=ring2,DC=com</code><li>objectCategory: 此实例所属类设置的defaultObjectCategory，这里是classSchema类<li>objectClass： 此实例所属类及所有父类的lDAPDisplayName<li>lDAPDisplayName： 用于对objectCategory做检索时使用<li>subClassof : 父类的lDAPDisplayName</ul><p>AD中的属性在Schema NC中也有对应的条目，以Comment属性为例:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/image-20201115145953878.png" alt="image-20201115145953878" /></p><p>依据上图中attributeSyntax和oMSntax的值，查询下表，可以知道comments是一个unicode string。</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/t01110de96a7eeb8a2d.png" alt="img" /></p><h3 id="configuration-nc">Configuration NC</h3><p>存储配置信息，比如DCSync中用到的DS-Replication-Get-Changes-All Extended Rights</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/image-20201115184329725.png" alt="image-20201115184329725" /></p><h2 id="ldap查询">LDAP查询</h2><p>https://knowledge.broadcom.com/external/article/164552/how-to-set-up-ldap-filter-for-nested-gro.html (Filter语法、常用查询语句)</p><ul><li>(uid=testuser)</ul><p>匹配 uid 属性为testuser的所有对象</p><ul><li>(uid=test*)</ul><p>匹配 uid 属性以test开头的所有对象</p><ul><li>(!(uid=test*))</ul><p>匹配 uid 属性不以test开头的所有对象</p><ul><li>(&amp;(department=1234)(city=Paris))</ul><p>匹配 department 属性为1234且city属性为Paris的所有对象</p><ul><li><code class="language-plaintext highlighter-rouge">(|(department=1234)(department=56*))</code></ul><p>匹配 department 属性的值刚好为1234或者以56开头的所有对象。</p><p>除此之外，经常在powerview.ps1等工具里看到以下查询命令 <code class="language-plaintext highlighter-rouge">userAccountControl:1.2.840.113556.1.4.803:=65536</code>，这个是LDAP的高级用法，位掩码查询。<code class="language-plaintext highlighter-rouge">userAccountControl</code>是一个32 bit值，对应的位字段含义如下:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/t014df9519f018df4a7.png" alt="img" /></p><p>要按位过滤，使用以下语法</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>&lt;属性名称&gt;：&lt;BitFilterRule-ID&gt; := &lt;十进制比较值&gt;
</pre></table></code></div></div><p>其中的<code class="language-plaintext highlighter-rouge">&lt;BitFilterRule-ID&gt;</code>，内容如下</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/t01a25c7551c331ecdc.png" alt="img" /></p><h3 id="objectcategory-与-objectclass">objectCategory 与 objectClass</h3><ol><li><p>objectClass是一个多值属性，比如说<code class="language-plaintext highlighter-rouge">CN=jane,CN=Users,DC=test,DC=local</code>的<code class="language-plaintext highlighter-rouge">objectClass</code>是<code class="language-plaintext highlighter-rouge">top,person,organizationalPerson,user</code>。那我们通过过滤语句<code class="language-plaintext highlighter-rouge">(objectClass=user)</code>,<code class="language-plaintext highlighter-rouge">(objectClass=organizationalPerson)</code>都能找到这个对象。</p><li><p>使用objectCategory过滤，可以用lDAPDisplayName简化查询。</p><p><code class="language-plaintext highlighter-rouge">(objectCategory=cn=person,cn=Schema,cn=Configuration,dc=MyDomain,dc=com)</code></p><p>简化为:</p><p><code class="language-plaintext highlighter-rouge">(objectCategory=person)</code></p><li><p>Windows Server 2008之前默认不对objectClass 属性进行索引，所以一般先用objectCategory划出一个大范围，再用objectClass精确到小范围。</p><p><code class="language-plaintext highlighter-rouge">(&amp;(objectCategory=person)(objectClass=user))</code></p><p>如果在目录中已经索引了ObjectClass ，或者所有域控制器都在运行Windows Server 2008或更高版本，则不用考虑效率问题。</p></ol><h3 id="samr-协议查询">SAMR 协议查询</h3><p>除了使用LDAP查询域用户、用户组，还可以使用SAMR协议查询。以下命令就是基于SAMR实现的</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>net user /domain
net group /domain
</pre></table></code></div></div><h2 id="组-group">组 group</h2><p>所有的组都是<code class="language-plaintext highlighter-rouge">group</code>类的实例，可以用<code class="language-plaintext highlighter-rouge">(objectClass=group)</code>或者<code class="language-plaintext highlighter-rouge">(objectCategory=group)</code>来过滤组。按照用途来分，分为通讯组和安全组，我们常接触的Domain Admins, Administrators就是安全组，安全组就是一组权限的集合。</p><p>group和OU的区别是，group是管理者的集合，OU是被管理者的集合。</p><p>安全组分以下三类:</p><ul><li><p>全局组 (Global group)</p><li><p>通用组(Universal group)</p><li><p>域本地组(Domain Local group)</p></ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/image-20201115160741335.png" alt="image-20201115160741335" /></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/image-20201115160711270.png" alt="image-20201115160711270" /></p><h2 id="机器用户">机器用户</h2><p>computer类是user类的子类，机器用户其实就是一个域用户，其用户名是<code class="language-plaintext highlighter-rouge">机器名$</code></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/image-20201115162032523.png" alt="image-20201115162032523" /></p><h2 id="组策略">组策略</h2><p><code class="language-plaintext highlighter-rouge">gpmc.msc</code> 打开组策略管理</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/image-20201202175558169.png" alt="image-20201202175558169" /></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/t01a0593462f7373af7.png" alt="img" /></p><h2 id="参考">参考</h2><p>https://daiker.gitbook.io/windows-protocol/ldap-pian/8</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/%E5%9F%9F%E5%AE%89%E5%85%A8/'>域安全</a>, <a href='/categories/%E8%83%8C%E6%99%AF%E7%9F%A5%E8%AF%86/'>背景知识</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/activedirectory/" class="post-tag no-text-decoration" >ActiveDirectory</a> <a href="/tags/ldap/" class="post-tag no-text-decoration" >ldap</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Active Directory简介 - 我的学习笔记&url=https://ringlcy.github.io/posts/ActiveDirectory%E7%AE%80%E4%BB%8B/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Active Directory简介 - 我的学习笔记&u=https://ringlcy.github.io/posts/ActiveDirectory%E7%AE%80%E4%BB%8B/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Active Directory简介 - 我的学习笔记&url=https://ringlcy.github.io/posts/ActiveDirectory%E7%AE%80%E4%BB%8B/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ta0006%E5%87%AD%E6%8D%AE%E8%AE%BF%E9%97%AE/">TA0006凭据访问</a> <a class="post-tag" href="/tags/ta0003%E6%8C%81%E4%B9%85%E5%8C%96/">TA0003持久化</a> <a class="post-tag" href="/tags/mimikatz/">mimikatz</a> <a class="post-tag" href="/tags/ta0004%E6%9D%83%E9%99%90%E5%8D%87%E7%BA%A7/">TA0004权限升级</a> <a class="post-tag" href="/tags/ta0008%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/">TA0008横向移动</a> <a class="post-tag" href="/tags/activedirectory/">ActiveDirectory</a> <a class="post-tag" href="/tags/adminsdholder/">AdminSDHolder</a> <a class="post-tag" href="/tags/as-rep-roasting/">AS-REP Roasting</a> <a class="post-tag" href="/tags/dcshadow/">DCShadow</a> <a class="post-tag" href="/tags/dcsync/">dcsync</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/SMB%E5%8D%8F%E8%AE%AE%E4%B8%8EIPC$/"><div class="card-body"> <span class="timeago small" > Dec 31, 2020 <i class="unloaded">2020-12-31T23:59:59+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>SMB协议与IPC$</h3><div class="text-muted small"><p> SMB协议与IPC$ RPC Chapter 14. Intermediary Protocols https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-wpo/7d2df784-557e-4fde-9281-9509653a0f17 远程过程调用(Remote Procedure Call, RPC)是一种进...</p></div></div></a></div><div class="card"> <a href="/posts/SPN/"><div class="card-body"> <span class="timeago small" > Dec 31, 2020 <i class="unloaded">2020-12-31T23:59:59+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>SPN</h3><div class="text-muted small"><p> 通过SPN查询域内服务 SPN Scanning – Service Discovery without Network Port Scanning Active Directory: PowerShell script to list all SPNs used Discovering Service Accounts Without Using Privileges ...</p></div></div></a></div><div class="card"> <a href="/posts/Windows%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6/"><div class="card-body"> <span class="timeago small" > Dec 31, 2020 <i class="unloaded">2020-12-31T23:59:59+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Windows访问控制</h3><div class="text-muted small"><p> SRM(Security reference monitor 安全引用监视器) Ntoskrnl.exe中的一个组件，工作在内核模式下，它负责：定义访问令牌的数据结构来表示一个安全环境、执行对象的访问检查、管理特权，以及生成所有的结果安全审计消息。 LSASS(Local Security Authority Subsystem本地安全权威子系统...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Kerberoasting/" class="btn btn-outline-primary" prompt="Older"><p>Kerberoasting</p></a> <a href="/posts/AdminSDHolder/" class="btn btn-outline-primary" prompt="Newer"><p>AdminSDHolder</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href=""></a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/ta0006%E5%87%AD%E6%8D%AE%E8%AE%BF%E9%97%AE/">TA0006凭据访问</a> <a class="post-tag" href="/tags/ta0003%E6%8C%81%E4%B9%85%E5%8C%96/">TA0003持久化</a> <a class="post-tag" href="/tags/mimikatz/">mimikatz</a> <a class="post-tag" href="/tags/ta0004%E6%9D%83%E9%99%90%E5%8D%87%E7%BA%A7/">TA0004权限升级</a> <a class="post-tag" href="/tags/ta0008%E6%A8%AA%E5%90%91%E7%A7%BB%E5%8A%A8/">TA0008横向移动</a> <a class="post-tag" href="/tags/activedirectory/">ActiveDirectory</a> <a class="post-tag" href="/tags/adminsdholder/">AdminSDHolder</a> <a class="post-tag" href="/tags/as-rep-roasting/">AS REP Roasting</a> <a class="post-tag" href="/tags/dcshadow/">DCShadow</a> <a class="post-tag" href="/tags/dcsync/">dcsync</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://ringlcy.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
